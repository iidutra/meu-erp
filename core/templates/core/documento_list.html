{% extends 'core/base.html' %}

{% block title %}Documentos{% endblock %}

{% block content %}
<h1 class="h3 mb-3">Documentos (Vendas / Ordens de Serviço)</h1>

<form method="get" class="card mb-3 p-3">
  <div class="row g-2 align-items-end">
    <div class="col-md-4">
      <label class="form-label">
        {% if request.user.perfil.empresa.ramo == 'AUTO' %}
        Cliente / placa / texto
        {% else %}
        Cliente / texto
        {% endif %}
      </label>
      <input type="text" name="q" class="form-control" value="{{ filtro_q }}">
    </div>
    <div class="col-md-2">
      <label class="form-label">Tipo</label>
      <select name="tipo" class="form-select">
        <option value="">Todos</option>
        <option value="VENDA" {% if filtro_tipo == 'VENDA' %}selected{% endif %}>Venda</option>
        <option value="OS" {% if filtro_tipo == 'OS' %}selected{% endif %}>Ordem de Serviço</option>
      </select>
    </div>
    <div class="col-md-2">
      <label class="form-label">Data inicial</label>
      <input type="date" name="data_ini" class="form-control" value="{{ filtro_data_ini }}">
    </div>
    <div class="col-md-2">
      <label class="form-label">Data final</label>
      <input type="date" name="data_fim" class="form-control" value="{{ filtro_data_fim }}">
    </div>
    <div class="col-md-2 text-end">
      <button type="submit" class="btn btn-primary w-100 mb-1">Filtrar</button>
      <a href="{% url 'core:documento_list' %}" class="btn btn-outline-secondary w-100 btn-sm">Limpar</a>
    </div>
  </div>
</form>

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>#</th>
      <th>Tipo</th>
      <th>Cliente</th>
      <th>Data</th>
      <th class="text-end">Total</th>
      <th class="text-end">Pago</th>
      <th class="text-end">Saldo</th>
      <th>Status</th>
      {% if request.user.perfil.empresa.ramo == 'AUTO' %}
      <th>Cliente / Placa</th>
      {% else %}
      <th>Cliente</th>
      {% endif %} <th></th>
    </tr>
  </thead>
  <tbody>
    {% for d in documentos %}
    <tr>
      <td>{{ d.id }}</td>
      <td>{{ d.get_tipo_display }}</td>
      <td>{{ d.cliente.nome }}</td>
      <td>{{ d.data|date:"d/m/Y H:i" }}</td>
      <td class="text-end">{{ d.total }}</td>
      <td class="text-end">{{ d.valor_pago }}</td>
      <td class="text-end">{{ d.saldo }}</td>
      <td>{{ d.status_financeiro }}</td>
      <td class="text-end">
        <a href="{% url 'core:documento_detail' d.pk %}" class="btn btn-sm btn-outline-secondary">Detalhes</a>
      </td>
      {% if request.user.perfil.empresa.ramo == 'AUTO' %}
      <td>
        {{ d.cliente.nome }}<br>
        <small class="text-muted">{{ d.placa }}</small>
      </td>
      {% else %}
      <th>Cliente</th>
      {% endif %}
    </tr>
    {% empty %}
    <tr>
      <td colspan="9" class="text-center">Nenhum documento.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}