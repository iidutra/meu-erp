{% extends 'core/base.html' %}

{% block title %}{{ documento.get_tipo_display }} #{{ documento.id }}{% endblock %}

{% block content %}
<h1 class="mb-3">{{ documento.get_tipo_display }} #{{ documento.id }}</h1>

<div class="mb-3">
  <a href="{% url 'core:documento_list' %}" class="btn btn-sm btn-outline-secondary">Voltar</a>
</div>

<div class="card mb-3">
  <div class="card-body">
    <h5 class="card-title">Dados do documento</h5>
    <div class="row">
      <div class="col-md-4">
        <strong>Empresa:</strong> {{ documento.empresa.nome_fantasia }}
      </div>
      <div class="col-md-4">
        <strong>Cliente:</strong> {{ documento.cliente.nome }}
      </div>
      <div class="col-md-4">
        <strong>Data:</strong> {{ documento.data|date:"d/m/Y H:i" }}
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-md-3">
        <strong>Total:</strong> R$ {{ documento.total }}
      </div>
      <div class="col-md-3">
        <strong>Pago:</strong> R$ {{ documento.valor_pago }}
      </div>
      <div class="col-md-3">
        <strong>Saldo:</strong> R$ {{ documento.saldo }}
      </div>
      <div class="col-md-3">
        <strong>Status:</strong> {{ documento.status_financeiro }}
      </div>
    </div>
    {% if documento.empresa.ramo == 'AUTO' %}
    <div class="row mt-2">
      <div class="col-md-3">
        <strong>Placa:</strong> {{ documento.placa|default:"—" }}
      </div>
      <div class="col-md-9">
        <strong>Veículo:</strong> {{ documento.veiculo_descricao|default:"—" }}
      </div>
    </div>
    {% endif %}
    {% if documento.origem_orcamento %}
    <div class="mt-2">
      <strong>Origem:</strong>
      Orçamento #{{ documento.origem_orcamento.id }}
      (<a href="{% url 'core:orcamento_detail' documento.origem_orcamento.pk %}">ver orçamento</a>)
    </div>
    {% endif %}
    {% if documento.observacoes %}
    <div class="mt-2">
      <strong>Observações:</strong><br>
      {{ documento.observacoes|linebreaks }}
    </div>
    {% endif %}
  </div>
</div>

<div class="card mb-3">
  <div class="card-body d-flex justify-content-between align-items-center">
    <h5 class="card-title mb-0">Pagamentos</h5>
    {% if documento.saldo > 0 %}
    <a href="{% url 'core:pagamento_create' documento.pk %}" class="btn btn-sm btn-primary">
      Registrar pagamento
    </a>
    {% endif %}
  </div>
  <div class="table-responsive">
    <table class="table table-sm mb-0">
      <thead class="table-light">
        <tr>
          <th>Data</th>
          <th>Forma</th>
          <th class="text-end">Valor</th>
          <th>Observações</th>
        </tr>
      </thead>
      <tbody>
        {% for p in documento.pagamentos.all %}
        <tr>
          <td>{{ p.data|date:"d/m/Y H:i" }}</td>
          <td>{{ p.get_forma_pagamento_display }}</td>
          <td class="text-end">{{ p.valor }}</td>
          <td>{{ p.observacoes }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="text-center">Nenhum pagamento registrado.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}